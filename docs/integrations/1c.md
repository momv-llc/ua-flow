# 1C / BAS OData Integration

## Overview
- **Protocol:** HTTPS + Basic auth
- **Base URL example:** `https://1c.partner.ua/odata/standard.odata/`
- **Supported operations:** catalogs, documents, accounts
- **Queue route:** `ua_flow.integrations` (task `backend.tasks.integration.run_sync`)

## Authentication
- HTTP Basic using service credentials issued by the customer.
- Credentials stored in the integration connection settings: `{ "username": "svc_user", "password": "***" }`.
- TLS 1.2+ required.

## Operations
| Operation | Method | Path | Notes |
| --- | --- | --- | --- |
| catalogs | GET | `/Catalog_Products` | Supports `$filter`, `$skip`, `$top`. Default page size 50. |
| documents | POST | `/Document_SalesOrder` | Payload follows 1C JSON schema, include `Date`, `Number`, `Items`. |
| accounts | POST | `/Document_Invoice` | Generates invoices; returns document UUID. |

## Payload Samples
```json
{
  "operation": "catalogs",
  "method": "GET",
  "payload": {
    "$filter": "IsActive eq true",
    "$top": 100
  }
}
```

```json
{
  "operation": "documents",
  "method": "POST",
  "payload": {
    "Date": "2024-09-18",
    "Number": "SO-155",
    "Customer": "ТОВ Нові Технології",
    "Items": [
      { "SKU": "SKU-001", "Quantity": 2, "Price": 12500 }
    ]
  }
}
```

## Scheduling & Retries
- Full catalog sync nightly at 02:00 Kyiv time.
- Incremental updates every 15 minutes (filter by `ModifiedAt ge now()-PT15M`).
- Celery retry policy: 5 retries, exponential backoff (base 2s, max 10 minutes).

## Sandbox
Use the Integration Hub sandbox endpoint:
```
POST /api/v1/integrations/sandboxes/one_c
{
  "operation": "catalogs",
  "method": "GET",
  "payload": { "limit": 5 }
}
```
The sandbox returns static data with pagination cursors for UI development.
